#!/SBUILD
_disabled: false

pkg: jq
pkg_id: github.com.jqlang.jq
pkg_type: static
category:
  - "ConsoleOnly"
  - "Utility"
description: Command-line JSON processor
homepage:
  - https://jqlang.github.io/jq/
maintainer:
  - pkgforge-dev
license:
  - MIT
src_url:
  - https://github.com/jqlang/jq

x_exec:
  host:
    - aarch64-Linux
    - x86_64-Linux
  shell: bash
  pkgver: |
    curl -qfsSL "https://api.github.com/repos/jqlang/jq/releases/latest" | jq -r '.tag_name' | tr -d 'jq-'
  run: |
    # Download pre-built jq binary
    case "$(uname -m)" in
      x86_64) JQ_ARCH="amd64" ;;
      aarch64) JQ_ARCH="arm64" ;;
      *) echo "Unsupported arch"; exit 1 ;;
    esac

    VERSION="$(curl -qfsSL "https://api.github.com/repos/jqlang/jq/releases/latest" | jq -r '.tag_name')"
    DOWNLOAD_URL="https://github.com/jqlang/jq/releases/download/${VERSION}/jq-linux-${JQ_ARCH}"

    echo "[+] Downloading jq ${VERSION} for ${JQ_ARCH}"
    curl -qfsSL "${DOWNLOAD_URL}" -o "$SBUILD_OUTDIR/jq"
    chmod +x "$SBUILD_OUTDIR/jq"

    # Verify
    file "$SBUILD_OUTDIR/jq"
    "$SBUILD_OUTDIR/jq" --version
